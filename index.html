<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sensor Monitoring System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }

        :root {
            --industrial-blue: #0a3147;
            --industrial-dark: #1e2b3a;
            --industrial-gray: #3a4a5a;
            --industrial-light: #e6e9f0;
            --industrial-accent: #00a8cc;
            --industrial-warning: #ffb142;
            --industrial-danger: #ff5252;
            --industrial-success: #33d9b2;
            --panel-bg: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #d1d9e6;
            --text-primary: #2c3e50;
            --text-secondary: #5f6b7a;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
        }

        body {
            background: linear-gradient(145deg, #e6e9f0 0%, #f5f7fa 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Industrial Header */
        .industrial-header {
            background: linear-gradient(90deg, var(--industrial-blue) 0%, var(--industrial-dark) 100%);
            color: white;
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--industrial-accent);
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .industrial-icon {
            font-size: 32px;
            color: var(--industrial-accent);
        }

        .title-area h1 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .title-area p {
            font-size: 12px;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-badge {
            background: var(--industrial-success);
            color: var(--industrial-dark);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* Notification Center */
        .notification-center {
            position: relative;
        }

        .notification-bell {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 16px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .notification-bell:hover {
            background: rgba(255,255,255,0.2);
        }

        .notification-bell i {
            font-size: 20px;
        }

        .notification-count {
            background: var(--industrial-danger);
            color: white;
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 700;
        }

        .notification-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            width: 380px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            display: none;
            z-index: 1000;
        }

        .notification-dropdown.active {
            display: block;
        }

        .notification-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            font-size: 16px;
            color: var(--industrial-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 8px;
        }

        .notification-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid;
            transition: all 0.2s;
        }

        .notification-item:hover {
            background: #f8f9fc;
        }

        .notification-item.critical {
            border-left-color: var(--industrial-danger);
            background: linear-gradient(90deg, rgba(255,82,82,0.05), transparent);
        }

        .notification-item.warning {
            border-left-color: var(--industrial-warning);
            background: linear-gradient(90deg, rgba(255,177,66,0.05), transparent);
        }

        .notification-item.info {
            border-left-color: var(--industrial-accent);
            background: linear-gradient(90deg, rgba(0,168,204,0.05), transparent);
        }

        .notification-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .notification-sensor {
            font-weight: 600;
            font-size: 14px;
        }

        .notification-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .notification-footer {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* Main Container */
        .industrial-container {
            padding: 24px 32px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
        }

        /* Left Panel - Sensor Management */
        .left-panel {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .panel-header {
            background: linear-gradient(145deg, var(--industrial-blue), var(--industrial-dark));
            color: white;
            padding: 20px;
        }

        .panel-header h2 {
            font-size: 18px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .panel-content {
            padding: 20px;
        }

        /* Add Sensor Form */
        .add-sensor-form {
            background: #f8fafd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .form-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--industrial-blue);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--industrial-accent);
            box-shadow: 0 0 0 3px rgba(0,168,204,0.1);
        }

        .btn-industrial {
            background: linear-gradient(145deg, var(--industrial-accent), #008bb5);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-industrial:hover {
            background: linear-gradient(145deg, #008bb5, var(--industrial-accent));
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Sensor Stats */
        .sensor-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(145deg, white, #f8fafd);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--industrial-blue);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Sensor List */
        .sensor-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .sensor-list-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .sensor-list-item:hover {
            background: #f8fafd;
        }

        .sensor-list-item.active {
            background: rgba(0,168,204,0.05);
            border-left: 4px solid var(--industrial-accent);
        }

        .sensor-status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .sensor-status-indicator.critical { background: var(--industrial-danger); }
        .sensor-status-indicator.warning { background: var(--industrial-warning); }
        .sensor-status-indicator.normal { background: var(--industrial-success); }
        .sensor-status-indicator.offline { background: var(--text-secondary); }

        .sensor-list-info {
            flex: 1;
        }

        .sensor-list-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .sensor-list-location {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .sensor-list-value {
            font-weight: 700;
            font-size: 16px;
            color: var(--industrial-blue);
        }

        /* Right Panel - Dashboard */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .kpi-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(145deg, var(--industrial-accent), #008bb5);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .kpi-content {
            flex: 1;
        }

        .kpi-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--industrial-blue);
            line-height: 1;
            margin-bottom: 4px;
        }

        .kpi-trend {
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend-up { color: var(--industrial-success); }
        .trend-down { color: var(--industrial-danger); }

        /* Graph Grid */
        .graph-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .graph-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .graph-card-full {
            grid-column: span 2;
        }

        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .graph-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 600;
            color: var(--industrial-blue);
        }

        .graph-controls {
            display: flex;
            gap: 8px;
        }

        .graph-control {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .graph-control:hover {
            background: var(--industrial-light);
            border-color: var(--industrial-accent);
        }

        .graph-control.active {
            background: var(--industrial-accent);
            color: white;
            border-color: var(--industrial-accent);
        }

        .chart-container {
            height: 280px;
            position: relative;
        }

        /* Industrial Table */
        .data-table-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 12px 16px;
            background: #f8fafd;
            color: var(--industrial-blue);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }

        .data-table tr:hover {
            background: #f8fafd;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .industrial-container {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .graph-grid {
                grid-template-columns: 1fr;
            }
            
            .graph-card-full {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .industrial-container {
                padding: 16px;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .notification-dropdown {
                width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Industrial Header -->
    <header class="industrial-header">
        <div class="logo-area">
            <div class="industrial-icon">
                <i class="fas fa-industry"></i>
            </div>
            <div class="title-area">
                <h1>MONITORING SYSTEM</h1>
                <p>
                    <i class="fas fa-shield-alt"></i> Industrial Grade Monitoring
                    <span class="status-badge">LIVE</span>
                </p>
            </div>
        </div>

        <!-- Notification Center - Top Right -->
        <div class="notification-center">
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <span class="notification-count" id="notificationCount">3</span>
                <span>Alerts</span>
            </div>
            <div class="notification-dropdown" id="notificationDropdown">
                <div class="notification-header">
                    <h3>
                        <i class="fas fa-bell"></i>
                        Active Alerts
                    </h3>
                    <div class="notification-actions">
                        <button class="graph-control" onclick="dashboard.acknowledgeAllAlerts()">
                            <i class="fas fa-check-double"></i>
                        </button>
                        <button class="graph-control" onclick="dashboard.resolveAllAlerts()">
                            <i class="fas fa-check-circle"></i>
                        </button>
                    </div>
                </div>
                <div class="notification-list" id="notificationList">
                    <!-- Notifications will be populated here -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="industrial-container">
        <!-- Left Panel - Sensor Management -->
        <div class="left-panel">
            <div class="panel-header">
                <h2>
                    <i class="fas fa-microchip"></i>
                    SENSOR MANAGEMENT
                </h2>
                <p>Add and configure tilt sensors</p>
            </div>
            <div class="panel-content">
                <!-- Add Sensor Form -->
                <div class="add-sensor-form">
                    <div class="form-title">
                        <i class="fas fa-plus-circle"></i>
                        ADD NEW TILT SENSOR
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sensor ID / Code</label>
                        <input type="text" class="form-input" id="sensorCode" placeholder="e.g., TILT-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Installation Location</label>
                        <input type="text" class="form-input" id="sensorLocation" placeholder="e.g., Building A, Column 7">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Zone / Area</label>
                        <select class="form-select" id="sensorZone">
                            <option value="foundation">Foundation</option>
                            <option value="column">Column</option>
                            <option value="beam">Beam</option>
                            <option value="wall">Wall</option>
                            <option value="bridge">Bridge Section</option>
                            <option value="tower">Tower</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Critical Angle Threshold (°)</label>
                        <input type="number" class="form-input" id="criticalThreshold" value="3.0" step="0.1">
                    </div>
                    <button class="btn-industrial" onclick="dashboard.addTiltSensor()">
                        <i class="fas fa-plus"></i>
                        ADD SENSOR
                    </button>
                </div>

                <!-- Sensor Statistics -->
                <div class="sensor-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalSensors">12</div>
                        <div class="stat-label">Total Sensors</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeSensors">10</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="warningSensors">2</div>
                        <div class="stat-label">Warning</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="criticalSensors">1</div>
                        <div class="stat-label">Critical</div>
                    </div>
                </div>

                <!-- Sensor List -->
                <div class="form-title">
                    <i class="fas fa-list"></i>
                    ACTIVE SENSORS
                </div>
                <div class="sensor-list" id="sensorList">
                    <!-- Sensor items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Right Panel - Dashboard -->
        <div class="right-panel">
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Avg. Tilt Angle</div>
                        <div class="kpi-value" id="avgTilt">2.4°</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-arrow-up"></i> 0.3° from last hour
                        </div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Max Tilt Angle</div>
                        <div class="kpi-value" id="maxTilt">4.8°</div>
                        <div class="kpi-trend trend-down">
                            <i class="fas fa-arrow-down"></i> Critical
                        </div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">System Health</div>
                        <div class="kpi-value" id="systemHealth">94%</div>
                        <div class="kpi-trend">
                            <i class="fas fa-check-circle"></i> Operational
                        </div>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-label">Last Update</div>
                        <div class="kpi-value" id="lastUpdate">2s</div>
                        <div class="kpi-trend">
                            <i class="fas fa-sync-alt"></i> Real-time
                        </div>
                    </div>
                </div>
            </div>

            <!-- Graph Grid - Multiple Industrial Graphs -->
            <div class="graph-grid">
                <!-- Real-time Tilt Monitoring -->
                <div class="graph-card graph-card-full">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-chart-line"></i>
                            REAL-TIME TILT MONITORING - ALL SENSORS
                        </div>
                        <div class="graph-controls">
                            <button class="graph-control active" onclick="dashboard.setTimeRange('1h')">1H</button>
                            <button class="graph-control" onclick="dashboard.setTimeRange('6h')">6H</button>
                            <button class="graph-control" onclick="dashboard.setTimeRange('24h')">24H</button>
                            <button class="graph-control" onclick="dashboard.setTimeRange('7d')">7D</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="realtimeChart"></canvas>
                    </div>
                </div>

                <!-- Historical Trend Analysis -->
                <div class="graph-card">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-history"></i>
                            HISTORICAL TREND
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Sensor Distribution -->
                <div class="graph-card">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-chart-pie"></i>
                            SENSOR STATUS DISTRIBUTION
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>

                <!-- Tilt Pattern Analysis -->
                <div class="graph-card">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-wave-square"></i>
                            TILT PATTERN ANALYSIS
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="patternChart"></canvas>
                    </div>
                </div>

                <!-- Threshold Monitoring -->
                <div class="graph-card">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-sliders-h"></i>
                            THRESHOLD MONITORING
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="thresholdChart"></canvas>
                    </div>
                </div>

                <!-- X-Y Axis Analysis -->
                <div class="graph-card">
                    <div class="graph-header">
                        <div class="graph-title">
                            <i class="fas fa-arrows-alt"></i>
                            X-Y AXIS ANALYSIS
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="axisChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Sensor Data Table -->
            <div class="data-table-container">
                <div class="graph-header">
                    <div class="graph-title">
                        <i class="fas fa-table"></i>
                        TILT SENSOR READINGS - LIVE DATA
                    </div>
                    <div class="graph-controls">
                        <button class="graph-control" onclick="dashboard.exportData()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Sensor ID</th>
                            <th>Location</th>
                            <th>Zone</th>
                            <th>X-Axis (°)</th>
                            <th>Y-Axis (°)</th>
                            <th>Total Tilt (°)</th>
                            <th>Status</th>
                            <th>Last Update</th>
                        </tr>
                    </thead>
                    <tbody id="sensorDataTable">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Number Formatter Utility
        class NumberFormatter {
            static format(value, unit = '', decimals = 2) {
                if (value === null || value === undefined) return 'N/A';
                
                // Handle large numbers
                if (Math.abs(value) >= 1000000) {
                    return (value / 1000000).toFixed(2) + 'M' + unit;
                } else if (Math.abs(value) >= 1000) {
                    return (value / 1000).toFixed(2) + 'K' + unit;
                } else {
                    return value.toFixed(decimals) + unit;
                }
            }
            
            static formatAngle(value) {
                return this.format(value, '°', 2);
            }
        }

        // Industrial Tilt Sensor Dashboard
        class IndustrialTiltDashboard {
            constructor() {
                this.sensors = [];
                this.alerts = [];
                this.charts = {};
                this.currentTimeRange = '6h';
                this.notificationVisible = false;
                
                this.initializeSampleSensors();
                this.initializeCharts();
                this.startDataSimulation();
                this.setupEventListeners();
            }
            
            // Initialize with sample tilt sensors
            initializeSampleSensors() {
                const locations = [
                    'Building A - Column 7', 'Building A - Column 12', 'Building B - Foundation',
                    'Bridge Section 3', 'Water Tank Base', 'Tower Foundation',
                    'Roof Structure', 'Support Beam 5', 'Retaining Wall',
                    'Industrial Chimney', 'Conveyor System', 'Crane Base'
                ];
                
                const zones = ['foundation', 'column', 'beam', 'wall', 'bridge', 'tower'];
                
                for (let i = 1; i <= 12; i++) {
                    const tiltX = (Math.random() * 3 - 1.5);
                    const tiltY = (Math.random() * 3 - 1.5);
                    const totalTilt = Math.sqrt(tiltX * tiltX + tiltY * tiltY);
                    
                    this.sensors.push({
                        id: `TILT-${i.toString().padStart(3, '0')}`,
                        code: `TILT-${i.toString().padStart(3, '0')}`,
                        location: locations[i - 1],
                        zone: zones[Math.floor(Math.random() * zones.length)],
                        tiltX: tiltX,
                        tiltY: tiltY,
                        totalTilt: totalTilt,
                        threshold: 3.0,
                        status: totalTilt > 3 ? 'critical' : totalTilt > 2.5 ? 'warning' : 'normal',
                        lastUpdate: new Date(),
                        history: []
                    });
                }
                
                this.generateInitialHistory();
                this.updateStats();
                this.renderSensorList();
                this.renderDataTable();
                this.checkThresholds();
            }
            
            // Generate historical data
            generateInitialHistory() {
                this.sensors.forEach(sensor => {
                    for (let i = 0; i < 100; i++) {
                        const time = new Date(Date.now() - (99 - i) * 3600000);
                        const variation = Math.sin(i * 0.1) * 0.5 + (Math.random() - 0.5) * 0.3;
                        sensor.history.push({
                            timestamp: time,
                            value: Math.max(0, Math.min(5, sensor.totalTilt + variation))
                        });
                    }
                });
            }
            
            // Initialize all charts
            initializeCharts() {
                this.initRealtimeChart();
                this.initTrendChart();
                this.initDistributionChart();
                this.initPatternChart();
                this.initThresholdChart();
                this.initAxisChart();
            }
            
            // Real-time monitoring chart
            initRealtimeChart() {
                const ctx = document.getElementById('realtimeChart').getContext('2d');
                
                const datasets = this.sensors.slice(0, 6).map((sensor, index) => ({
                    label: sensor.id,
                    data: sensor.history.slice(-24).map(h => h.value),
                    borderColor: this.getStatusColor(sensor.status),
                    backgroundColor: 'transparent',
                    borderWidth: 2,
                    pointRadius: 2,
                    tension: 0.4
                }));
                
                this.charts.realtime = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${23-i}h`).reverse(),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: { usePointStyle: true, boxWidth: 6 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                title: {
                                    display: true,
                                    text: 'Tilt Angle (°)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Historical trend chart
            initTrendChart() {
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                const dailyAverages = Array.from({length: 30}, (_, i) => {
                    const sum = this.sensors.reduce((acc, s) => {
                        const dayData = s.history.filter(h => 
                            h.timestamp > new Date(Date.now() - (29 - i) * 86400000)
                        );
                        return acc + (dayData.reduce((sum, d) => sum + d.value, 0) / dayData.length || 0);
                    }, 0);
                    return sum / this.sensors.length;
                });
                
                this.charts.trend = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 30}, (_, i) => `Day ${i+1}`),
                        datasets: [{
                            label: 'Average Tilt',
                            data: dailyAverages,
                            borderColor: 'var(--industrial-accent)',
                            backgroundColor: 'rgba(0,168,204,0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Distribution chart
            initDistributionChart() {
                const ctx = document.getElementById('distributionChart').getContext('2d');
                
                const normal = this.sensors.filter(s => s.status === 'normal').length;
                const warning = this.sensors.filter(s => s.status === 'warning').length;
                const critical = this.sensors.filter(s => s.status === 'critical').length;
                
                this.charts.distribution = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Normal', 'Warning', 'Critical'],
                        datasets: [{
                            data: [normal, warning, critical],
                            backgroundColor: [
                                'var(--industrial-success)',
                                'var(--industrial-warning)',
                                'var(--industrial-danger)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            // Pattern analysis chart
            initPatternChart() {
                const ctx = document.getElementById('patternChart').getContext('2d');
                
                const hourlyData = Array.from({length: 24}, (_, hour) => {
                    const sum = this.sensors.reduce((acc, s) => {
                        const hourData = s.history.filter(h => 
                            h.timestamp.getHours() === hour
                        );
                        return acc + (hourData.reduce((sum, d) => sum + d.value, 0) / hourData.length || 0);
                    }, 0);
                    return sum / this.sensors.length;
                });
                
                this.charts.pattern = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Average Tilt by Hour',
                            data: hourlyData,
                            backgroundColor: 'rgba(0,168,204,0.7)',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Threshold monitoring chart
            initThresholdChart() {
                const ctx = document.getElementById('thresholdChart').getContext('2d');
                
                const sensorData = this.sensors.slice(0, 8).map(s => ({
                    x: s.id,
                    y: s.totalTilt
                }));
                
                this.charts.threshold = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sensorData.map(d => d.x),
                        datasets: [{
                            label: 'Current Tilt',
                            data: sensorData.map(d => d.y),
                            backgroundColor: sensorData.map(d => 
                                d.y > 3 ? 'var(--industrial-danger)' :
                                d.y > 2.5 ? 'var(--industrial-warning)' :
                                'var(--industrial-success)'
                            ),
                            borderRadius: 4
                        }, {
                            label: 'Critical Threshold',
                            data: sensorData.map(() => 3),
                            type: 'line',
                            borderColor: 'var(--industrial-danger)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5
                            }
                        }
                    }
                });
            }
            
            // X-Y Axis analysis chart
            initAxisChart() {
                const ctx = document.getElementById('axisChart').getContext('2d');
                
                this.charts.axis = new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Sensor Positions',
                            data: this.sensors.map(s => ({
                                x: s.tiltX,
                                y: s.tiltY
                            })),
                            backgroundColor: this.sensors.map(s => 
                                s.totalTilt > 3 ? 'var(--industrial-danger)' :
                                s.totalTilt > 2.5 ? 'var(--industrial-warning)' :
                                'var(--industrial-success)'
                            ),
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: { display: true, text: 'X-Axis Tilt (°)' },
                                min: -2,
                                max: 2
                            },
                            y: {
                                title: { display: true, text: 'Y-Axis Tilt (°)' },
                                min: -2,
                                max: 2
                            }
                        }
                    }
                });
            }
            
            // Update all charts
            updateCharts() {
                if (this.charts.realtime) {
                    this.charts.realtime.data.datasets = this.sensors.slice(0, 6).map((sensor, index) => ({
                        label: sensor.id,
                        data: sensor.history.slice(-24).map(h => h.value),
                        borderColor: this.getStatusColor(sensor.status),
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 2,
                        tension: 0.4
                    }));
                    this.charts.realtime.update();
                }
                
                if (this.charts.distribution) {
                    const normal = this.sensors.filter(s => s.status === 'normal').length;
                    const warning = this.sensors.filter(s => s.status === 'warning').length;
                    const critical = this.sensors.filter(s => s.status === 'critical').length;
                    this.charts.distribution.data.datasets[0].data = [normal, warning, critical];
                    this.charts.distribution.update();
                }
                
                if (this.charts.threshold) {
                    this.charts.threshold.data.labels = this.sensors.slice(0, 8).map(s => s.id);
                    this.charts.threshold.data.datasets[0].data = this.sensors.slice(0, 8).map(s => s.totalTilt);
                    this.charts.threshold.data.datasets[0].backgroundColor = this.sensors.slice(0, 8).map(s => 
                        s.totalTilt > 3 ? 'var(--industrial-danger)' :
                        s.totalTilt > 2.5 ? 'var(--industrial-warning)' :
                        'var(--industrial-success)'
                    );
                    this.charts.threshold.update();
                }
                
                if (this.charts.axis) {
                    this.charts.axis.data.datasets[0].data = this.sensors.map(s => ({
                        x: s.tiltX,
                        y: s.tiltY
                    }));
                    this.charts.axis.data.datasets[0].backgroundColor = this.sensors.map(s => 
                        s.totalTilt > 3 ? 'var(--industrial-danger)' :
                        s.totalTilt > 2.5 ? 'var(--industrial-warning)' :
                        'var(--industrial-success)'
                    );
                    this.charts.axis.update();
                }
            }
            
            // Start data simulation
            startDataSimulation() {
                setInterval(() => {
                    this.sensors.forEach(sensor => {
                        // Simulate natural movement
                        const driftX = (Math.random() - 0.5) * 0.1;
                        const driftY = (Math.random() - 0.5) * 0.1;
                        
                        sensor.tiltX += driftX;
                        sensor.tiltY += driftY;
                        
                        // Keep within bounds
                        sensor.tiltX = Math.max(-5, Math.min(5, sensor.tiltX));
                        sensor.tiltY = Math.max(-5, Math.min(5, sensor.tiltY));
                        
                        // Calculate total tilt
                        sensor.totalTilt = Math.sqrt(
                            sensor.tiltX * sensor.tiltX + 
                            sensor.tiltY * sensor.tiltY
                        );
                        
                        // Update status
                        sensor.status = sensor.totalTilt > 3 ? 'critical' : 
                                      sensor.totalTilt > 2.5 ? 'warning' : 'normal';
                        
                        sensor.lastUpdate = new Date();
                        
                        // Add to history
                        sensor.history.push({
                            timestamp: new Date(),
                            value: sensor.totalTilt
                        });
                        
                        if (sensor.history.length > 100) {
                            sensor.history.shift();
                        }
                    });
                    
                    this.updateStats();
                    this.renderSensorList();
                    this.renderDataTable();
                    this.updateCharts();
                    this.checkThresholds();
                    
                }, 3000);
            }
            
            // Check thresholds and create alerts
            checkThresholds() {
                this.sensors.forEach(sensor => {
                    if (sensor.status === 'critical' || sensor.status === 'warning') {
                        const existingAlert = this.alerts.find(a => 
                            a.sensorId === sensor.id && 
                            !a.resolved
                        );
                        
                        if (!existingAlert) {
                            const alert = {
                                id: `alert-${Date.now()}-${sensor.id}`,
                                sensorId: sensor.id,
                                sensorName: sensor.id,
                                location: sensor.location,
                                level: sensor.status,
                                value: sensor.totalTilt,
                                threshold: 3.0,
                                message: `${sensor.id} at ${sensor.location} is reporting ${sensor.status} tilt level: ${sensor.totalTilt.toFixed(2)}°`,
                                timestamp: new Date(),
                                acknowledged: false,
                                resolved: false
                            };
                            
                            this.alerts.unshift(alert);
                            
                            if (this.alerts.length > 20) {
                                this.alerts.pop();
                            }
                        }
                    }
                });
                
                this.renderNotifications();
            }
            
            // Render notifications
            renderNotifications() {
                const notificationList = document.getElementById('notificationList');
                const activeAlerts = this.alerts.filter(a => !a.resolved);
                
                document.getElementById('notificationCount').textContent = activeAlerts.length;
                
                notificationList.innerHTML = '';
                
                if (activeAlerts.length === 0) {
                    notificationList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No active alerts</div>';
                    return;
                }
                
                activeAlerts.slice(0, 10).forEach(alert => {
                    const item = document.createElement('div');
                    item.className = `notification-item ${alert.level}`;
                    item.innerHTML = `
                        <div class="notification-item-header">
                            <span class="notification-sensor">
                                <i class="fas fa-exclamation-triangle"></i> ${alert.sensorName}
                            </span>
                            <span class="notification-time">${this.getTimeAgo(alert.timestamp)}</span>
                        </div>
                        <div class="notification-message">${alert.message}</div>
                        <div class="notification-footer">
                            ${!alert.acknowledged ? 
                                '<button class="graph-control" onclick="dashboard.acknowledgeAlert(\'' + alert.id + '\')">Acknowledge</button>' : 
                                ''}
                            <button class="graph-control" onclick="dashboard.resolveAlert(\'' + alert.id + '\')">Resolve</button>
                        </div>
                    `;
                    notificationList.appendChild(item);
                });
            }
            
            // Get time ago string
            getTimeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - new Date(timestamp).getTime()) / 1000);
                
                if (seconds < 60) return 'just now';
                if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
                if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
                return Math.floor(seconds / 86400) + 'd ago';
            }
            
            // Update statistics
            updateStats() {
                const total = this.sensors.length;
                const active = this.sensors.filter(s => s.status !== 'offline').length;
                const warning = this.sensors.filter(s => s.status === 'warning').length;
                const critical = this.sensors.filter(s => s.status === 'critical').length;
                
                document.getElementById('totalSensors').textContent = total;
                document.getElementById('activeSensors').textContent = active;
                document.getElementById('warningSensors').textContent = warning;
                document.getElementById('criticalSensors').textContent = critical;
                
                const avgTilt = this.sensors.reduce((acc, s) => acc + s.totalTilt, 0) / total;
                document.getElementById('avgTilt').innerHTML = NumberFormatter.formatAngle(avgTilt);
                
                const maxTilt = Math.max(...this.sensors.map(s => s.totalTilt));
                document.getElementById('maxTilt').innerHTML = NumberFormatter.formatAngle(maxTilt);
                
                const health = ((total - critical - warning * 0.5) / total * 100).toFixed(1);
                document.getElementById('systemHealth').innerHTML = health + '%';
                
                document.getElementById('lastUpdate').innerHTML = '2s';
            }
            
            // Render sensor list
            renderSensorList() {
                const sensorList = document.getElementById('sensorList');
                sensorList.innerHTML = '';
                
                this.sensors.forEach(sensor => {
                    const item = document.createElement('div');
                    item.className = `sensor-list-item ${sensor.status === 'critical' ? 'active' : ''}`;
                    item.innerHTML = `
                        <div class="sensor-status-indicator ${sensor.status}"></div>
                        <div class="sensor-list-info">
                            <div class="sensor-list-name">${sensor.id}</div>
                            <div class="sensor-list-location">${sensor.location}</div>
                        </div>
                        <div class="sensor-list-value">${sensor.totalTilt.toFixed(2)}°</div>
                    `;
                    sensorList.appendChild(item);
                });
            }
            
            // Render data table
            renderDataTable() {
                const tableBody = document.getElementById('sensorDataTable');
                tableBody.innerHTML = '';
                
                this.sensors.forEach(sensor => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${sensor.id}</strong></td>
                        <td>${sensor.location}</td>
                        <td><span style="text-transform: capitalize;">${sensor.zone}</span></td>
                        <td>${sensor.tiltX.toFixed(2)}°</td>
                        <td>${sensor.tiltY.toFixed(2)}°</td>
                        <td><strong>${sensor.totalTilt.toFixed(2)}°</strong></td>
                        <td>
                            <span style="
                                display: inline-block;
                                padding: 4px 12px;
                                border-radius: 20px;
                                background: ${this.getStatusColor(sensor.status, 0.1)};
                                color: ${this.getStatusColor(sensor.status)};
                                font-weight: 600;
                                font-size: 11px;
                                text-transform: uppercase;
                            ">
                                ${sensor.status}
                            </span>
                        </td>
                        <td>${this.getTimeAgo(sensor.lastUpdate)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            // Get status color
            getStatusColor(status, opacity = 1) {
                const colors = {
                    critical: 'var(--industrial-danger)',
                    warning: 'var(--industrial-warning)',
                    normal: 'var(--industrial-success)',
                    offline: 'var(--text-secondary)'
                };
                
                if (opacity < 1) {
                    const color = colors[status] || colors.normal;
                    return color.replace(')', `, ${opacity})`).replace('rgb', 'rgba');
                }
                
                return colors[status] || colors.normal;
            }
            
            // Add new tilt sensor
            addTiltSensor() {
                const code = document.getElementById('sensorCode').value;
                const location = document.getElementById('sensorLocation').value;
                const zone = document.getElementById('sensorZone').value;
                const threshold = parseFloat(document.getElementById('criticalThreshold').value);
                
                if (!code || !location) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                const newSensor = {
                    id: code,
                    code: code,
                    location: location,
                    zone: zone,
                    tiltX: (Math.random() - 0.5) * 2,
                    tiltY: (Math.random() - 0.5) * 2,
                    totalTilt: Math.sqrt(Math.pow((Math.random() - 0.5) * 2, 2) + Math.pow((Math.random() - 0.5) * 2, 2)),
                    threshold: threshold,
                    status: 'normal',
                    lastUpdate: new Date(),
                    history: []
                };
                
                // Initialize history
                for (let i = 0; i < 24; i++) {
                    const time = new Date(Date.now() - (23 - i) * 3600000);
                    newSensor.history.push({
                        timestamp: time,
                        value: newSensor.totalTilt + (Math.random() - 0.5) * 0.3
                    });
                }
                
                this.sensors.push(newSensor);
                
                // Clear form
                document.getElementById('sensorCode').value = '';
                document.getElementById('sensorLocation').value = '';
                document.getElementById('criticalThreshold').value = '3.0';
                
                // Update UI
                this.updateStats();
                this.renderSensorList();
                this.renderDataTable();
                this.updateCharts();
                
                // Add notification
                const alert = {
                    id: `alert-${Date.now()}`,
                    sensorId: newSensor.id,
                    sensorName: newSensor.id,
                    location: newSensor.location,
                    level: 'info',
                    value: newSensor.totalTilt,
                    threshold: threshold,
                    message: `New sensor ${newSensor.id} added at ${newSensor.location}`,
                    timestamp: new Date(),
                    acknowledged: false,
                    resolved: false
                };
                
                this.alerts.unshift(alert);
                this.renderNotifications();
            }
            
            // Acknowledge alert
            acknowledgeAlert(alertId) {
                const alert = this.alerts.find(a => a.id === alertId);
                if (alert) {
                    alert.acknowledged = true;
                    this.renderNotifications();
                }
            }
            
            // Resolve alert
            resolveAlert(alertId) {
                const alert = this.alerts.find(a => a.id === alertId);
                if (alert) {
                    alert.resolved = true;
                    this.renderNotifications();
                }
            }
            
            // Acknowledge all alerts
            acknowledgeAllAlerts() {
                this.alerts.forEach(alert => {
                    if (!alert.resolved) {
                        alert.acknowledged = true;
                    }
                });
                this.renderNotifications();
            }
            
            // Resolve all alerts
            resolveAllAlerts() {
                this.alerts.forEach(alert => {
                    alert.resolved = true;
                });
                this.renderNotifications();
            }
            
            // Set time range
            setTimeRange(range) {
                this.currentTimeRange = range;
                
                // Update active state
                document.querySelectorAll('.graph-control').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                event.target.classList.add('active');
            }
            
            // Export data
            exportData() {
                const data = this.sensors.map(s => ({
                    id: s.id,
                    location: s.location,
                    zone: s.zone,
                    tiltX: s.tiltX.toFixed(2),
                    tiltY: s.tiltY.toFixed(2),
                    totalTilt: s.totalTilt.toFixed(2),
                    status: s.status,
                    lastUpdate: s.lastUpdate.toISOString()
                }));
                
                const csv = this.convertToCSV(data);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tilt-sensor-data-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            }
            
            // Convert to CSV
            convertToCSV(data) {
                const headers = Object.keys(data[0]);
                const rows = data.map(obj => headers.map(header => obj[header]).join(','));
                return [headers.join(','), ...rows].join('\n');
            }
            
            // Setup event listeners
            setupEventListeners() {
                // Notification toggle
                const notificationBell = document.getElementById('notificationBell');
                const notificationDropdown = document.getElementById('notificationDropdown');
                
                notificationBell.addEventListener('click', (e) => {
                    e.stopPropagation();
                    notificationDropdown.classList.toggle('active');
                });
                
                // Close notification dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!notificationBell.contains(e.target) && 
                        !notificationDropdown.contains(e.target)) {
                        notificationDropdown.classList.remove('active');
                    }
                });
            }
        }

        // Initialize dashboard
        let dashboard;
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new IndustrialTiltDashboard();
            window.dashboard = dashboard;
        });
    </script>
</body>
</html>
